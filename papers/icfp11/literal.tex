%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% LITERAL formatting macros.
%
% The \literal macro defined here is similar in function but more general
% than the VERBATIM environment that is provided by LaTeX.  The text to
% typeset literally is enclosed between the invocation of the \literal
% macro and a line containing a single null character (i.e. ASCII code 0).
% By default, all text is typeset in TT font.  The text must not contain
% any control characters aside from newlines (in particular tabs are not
% allowed).  In the body of the text, **ALL** characters are reproduced
% as is except for the null character which is an escape character.
%
% Here is a simple example which prints a 4 line piece of code:
%
%    \literal{}
%    (define (f n)
%      (if (< n 2)
%        1
%        (* n (f (- n 1)))))
%    ^@
%
% In the following example, the two pieces of code are put side by side
% with the topmost lines aligned:
%
%    \hbox\bgroup
%    \vtop\bgroup
%    \literal{}
%    line a
%    line b
%    line c
%    ^@
%    \egroup
%    \vtop\bgroup
%    \literal{}
%    line 1
%    line 2
%    ^@
%    \egroup
%    \egroup
%
% The following optional arguments can be put in the braces of the \literal:
%
%   - \numberlinesfrom{n}           generate line numbers starting with n
%   - \linespacing{1.5ex}           set the spacing between the lines
%   - \footnotesize, \large, etc.   select the font size

\catcode`\@=11

\newbox\@@strutbox
\newbox\@@linebox
\newdimen\@@linespace
\newdimen\@@struth
\newdimen\@@strutd
\newdimen\@@lineh
\newdimen\@@lined
\newcounter{@@linenum}

\catcode`\^^M=13%
\def\literal#1{\bgroup%
\setcounter{@@linenum}{1}%
\def\getlinespacing{.27ex}%
\def\linespacing##1{\def\getlinespacing{##1}}%
\def\genlinenum{}%
\def\numberlinesfrom##1{\setcounter{@@linenum}{##1}%
\def\genlinenum{\hspace{1.5em}\llap{\clinenum$\scriptstyle\the@@linenum.$\hspace{.5em}}}}%
\frenchspacing%
#1\baselineskip0pt\lineskip0pt\tt%
\addtocounter{@@linenum}{-1}%
\refstepcounter{@@linenum}%
\@@linespace\getlinespacing%
\setbox\@@strutbox\hbox{'/[]y}%
\@@struth=\ht\@@strutbox%
\@@strutd=\dp\@@strutbox%
\@@lineh=\ht\@@strutbox\advance\@@lineh.66666\@@linespace%
\@@lined=\dp\@@strutbox\advance\@@lined.33333\@@linespace%
\def\startofline{\setbox\@@linebox\hbox\bgroup\genlinenum}%
\def\firstline{\startofline\@ifnextchar^^M{\@gobble}{}}%
\def\endofline{\egroup\ht\@@linebox\@@lineh\dp\@@linebox\@@lined\box\@@linebox%
\refstepcounter{@@linenum}}%
\def^^M{\endofline\@ifnextchar\^^M{\egroup\@gobble}{\startofline}}%
\catcode`\^^@=0\catcode`\^^A=15\catcode`\^^B=15\catcode`\^^C=15%
\catcode`\^^D=15\catcode`\^^E=15\catcode`\^^F=15\catcode`\^^G=15%
\catcode`\^^H=15\catcode`\^^I=15\catcode`\^^J=15\catcode`\^^K=15%
\catcode`\^^L=15\catcode`\^^M=13\catcode`\^^N=15\catcode`\^^O=15%
\catcode`\^^P=15\catcode`\^^Q=15\catcode`\^^R=15\catcode`\^^S=15%
\catcode`\^^T=15\catcode`\^^U=15\catcode`\^^V=15\catcode`\^^W=15%
\catcode`\^^X=15\catcode`\^^Y=15\catcode`\^^Z=15\catcode`\^^[=15%
\catcode`\^^\=15\catcode`\^^]=15\catcode`\^^^=15\catcode`\^^_=15%
\catcode`\ =13\catcode`\!=12\catcode`\"=12\catcode`\#=12%
\catcode`\$=12\catcode`\%=12\catcode`\&=12\catcode`\'=12%
\catcode`\(=12\catcode`\)=12\catcode`\*=12\catcode`\+=12%
\catcode`\,=12\catcode`\-=12\catcode`\.=12\catcode`\/=12%
\catcode`\0=12\catcode`\1=12\catcode`\2=12\catcode`\3=12%
\catcode`\4=12\catcode`\5=12\catcode`\6=12\catcode`\7=12%
\catcode`\8=12\catcode`\9=12\catcode`\:=12\catcode`\;=12%
\catcode`\<=12\catcode`\==12\catcode`\>=12\catcode`\?=12%
\catcode`\@=12\catcode`\A=11\catcode`\B=11\catcode`\C=11%
\catcode`\D=11\catcode`\E=11\catcode`\F=11\catcode`\G=11%
\catcode`\H=11\catcode`\I=11\catcode`\J=11\catcode`\K=11%
\catcode`\L=11\catcode`\M=11\catcode`\N=11\catcode`\O=11%
\catcode`\P=11\catcode`\Q=11\catcode`\R=11\catcode`\S=11%
\catcode`\T=11\catcode`\U=11\catcode`\V=11\catcode`\W=11%
\catcode`\X=11\catcode`\Y=11\catcode`\Z=11\catcode`\[=12%
\catcode`\\=12\catcode`\]=12\catcode`\^=12\catcode`\_=12%
\catcode`\`=12\catcode`\a=11\catcode`\b=11\catcode`\c=11%
\catcode`\d=11\catcode`\e=11\catcode`\f=11\catcode`\g=11%
\catcode`\h=11\catcode`\i=11\catcode`\j=11\catcode`\k=11%
\catcode`\l=11\catcode`\m=11\catcode`\n=11\catcode`\o=11%
\catcode`\p=11\catcode`\q=11\catcode`\r=11\catcode`\s=11%
\catcode`\t=11\catcode`\u=11\catcode`\v=11\catcode`\w=11%
\catcode`\x=11\catcode`\y=11\catcode`\z=11\catcode`\{=12%
\catcode`\|=12\catcode`\}=12\catcode`\~=12\catcode`\^^?=15%
\catcode"80=13\catcode"81=13\catcode"82=13\catcode"83=13%
\catcode"84=13\catcode"85=13\catcode"86=13\catcode"87=13%
\catcode"88=13\catcode"89=13\catcode"8A=13\catcode"8B=13%
\catcode"8C=13\catcode"8D=13\catcode"8E=13\catcode"8F=13%
\catcode"90=13\catcode"91=13\catcode"92=13\catcode"93=13%
\catcode"94=13\catcode"95=13\catcode"96=13\catcode"97=13%
\catcode"98=13\catcode"99=13\catcode"9A=13\catcode"9B=13%
\catcode"9C=13\catcode"9D=13\catcode"9E=13\catcode"9F=13%
\catcode"A0=13\catcode"A1=13\catcode"A2=13\catcode"A3=13%
\catcode"A4=13\catcode"A5=13\catcode"A6=13\catcode"A7=13%
\catcode"A8=13\catcode"A9=13\catcode"AA=13\catcode"AB=13%
\catcode"AC=13\catcode"AD=13\catcode"AE=13\catcode"AF=13%
\catcode"B0=13\catcode"B1=13\catcode"B2=13\catcode"B3=13%
\catcode"B4=13\catcode"B5=13\catcode"B6=13\catcode"B7=13%
\catcode"B8=13\catcode"B9=13\catcode"BA=13\catcode"BB=13%
\catcode"BC=13\catcode"BD=13\catcode"BE=13\catcode"BF=13%
\catcode"C0=13\catcode"C1=13\catcode"C2=13\catcode"C3=13%
\catcode"C4=13\catcode"C5=13\catcode"C6=13\catcode"C7=13%
\catcode"C8=13\catcode"C9=13\catcode"CA=13\catcode"CB=13%
\catcode"CC=13\catcode"CD=13\catcode"CE=13\catcode"CF=13%
\catcode"D0=13\catcode"D1=13\catcode"D2=13\catcode"D3=13%
\catcode"D4=13\catcode"D5=13\catcode"D6=13\catcode"D7=13%
\catcode"D8=13\catcode"D9=13\catcode"DA=13\catcode"DB=13%
\catcode"DC=13\catcode"DD=13\catcode"DE=13\catcode"DF=13%
\catcode"E0=13\catcode"E1=13\catcode"E2=13\catcode"E3=13%
\catcode"E4=13\catcode"E5=13\catcode"E6=13\catcode"E7=13%
\catcode"E8=13\catcode"E9=13\catcode"EA=13\catcode"EB=13%
\catcode"EC=13\catcode"ED=13\catcode"EE=13\catcode"EF=13%
\catcode"F0=13\catcode"F1=13\catcode"F2=13\catcode"F3=13%
\catcode"F4=13\catcode"F5=13\catcode"F6=13\catcode"F7=13%
\catcode"F8=13\catcode"F9=13\catcode"FA=13\catcode"FB=13%
\catcode"FC=13\catcode"FD=13\catcode"FE=13\catcode"FF=13%
\firstline}%
\catcode`\^^M=5%



%%% ====================================================================
%%%  @LaTeX-style-file{
%%%     author          = "Mario Wolczko",
%%%     version         = "2",
%%%     date            = "21 May 1992",
%%%     time            = "20:55:01 BST",
%%%     filename        = "boxedminipage.sty",
%%%     email           = "mario@acm.org",
%%%     codetable       = "ISO/ASCII",
%%%     keywords        = "LaTeX, minipage, framebox",
%%%     supported       = "no",
%%%     docstring       = "LaTeX document-style option which defines
%%%     the boxedminipage environment -- just like minipage, but with
%%%     a box around it.",
%%%  }
%%% ====================================================================
%
% This file is in the public domain
%
% The thickness of the rules around the box is controlled by
% \fboxrule, and the distance between the rules and the edges of the
% inner box is governed by \fboxsep.
%
% This code is based on Lamport's minipage code.
%
% Fixed, 7 Jun 89 by Jerry Leichter
%	Leave \fboxsep worth of separation at top and bottom, not just at
%	the sides!
%
\def\boxedminipage{\@ifnextchar [{\@iboxedminipage}{\@iboxedminipage[c]}}

\def\@iboxedminipage[#1]#2{\leavevmode \@pboxswfalse
  \if #1b\vbox
    \else \if #1t\vtop
	     \else \ifmmode \vcenter
		       \else \@pboxswtrue $\vcenter
		    \fi
	  \fi
  \fi\bgroup % start of outermost vbox/vtop/vcenter
    \hsize #2
    \hrule\@height\fboxrule
    \hbox\bgroup % inner hbox
      \vrule\@width\fboxrule \hskip\fboxsep \vbox\bgroup % innermost vbox
	\vskip\fboxsep
	\advance\hsize -2\fboxrule \advance\hsize-2\fboxsep
	\textwidth\hsize \columnwidth\hsize
	\@parboxrestore
	\def\@mpfn{mpfootnote}\def\thempfn{\thempfootnote}\c@mpfootnote\z@
	\let\@footnotetext\@mpfootnotetext
	\let\@listdepth\@mplistdepth \@mplistdepth\z@
	\@minipagerestore\@minipagetrue
	\everypar{\global\@minipagefalse\everypar{}}}

\def\endboxedminipage{%
	\par\vskip-\lastskip
	\ifvoid\@mpfootins\else
	  \vskip\skip\@mpfootins\footnoterule\unvbox\@mpfootins\fi
	\vskip\fboxsep
      \egroup % ends the innermost \vbox
      \hskip\fboxsep \vrule\@width\fboxrule
    \egroup % ends the \hbox
    \hrule\@height\fboxrule
  \egroup% ends the vbox/vtop/vcenter
  \if@pboxsw $\fi}

\catcode`\@=12%
