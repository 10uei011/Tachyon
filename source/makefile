# JavaScript VM command
JSVM = d8 --allow_natives_syntax

# Base program source files
BASE_SRCS =                 \
    utility/debug.js        \
    utility/iterators.js    \
    utility/graph.js        \
    utility/arrays.js       \
    utility/hashmap.js      \
    utility/linkedlist.js   \
    utility/strings.js      \
    utility/modules.js      \
    parser/misc.js          \
    parser/scanner.js       \
    parser/parser.js        \
    parser/pp.js            \
    parser/ast-passes.js    \
    platform/memory.js      \
    ir/instructions.js      \
    ir/inline.js            \
    ir/cfg.js               \
    ir/functions.js         \
    ir/handlers.js          \
    ir/ir.js                \
    ir/lowering.js          \
    codegen/asm.js          \
    codegen/asm-x86.js      \
    codegen/linearscan.js   \
    codegen/backend.js      \
    codegen/ir-to-asm-x86.js\
    jslib/errors.js

# Main-specific source files
MAIN_SPEC_SRCS =            \
    main.js

# Test-specific source files
# Insert unit test files between testing.js and testmain.js
TEST_SPEC_SRCS =            \
    tests/testing.js        \
    utility/tests/*.js      \
    ir/tests/*.js           \
    codegen/tests/*.js      \
    programs/tests/*.js      \
    tests/testmain.js

# Main target source files
MAIN_SRCS =                 \
    $(BASE_SRCS)            \
    $(MAIN_SPEC_SRCS)

# Test target source files
TEST_SRCS =                 \
    $(BASE_SRCS)            \
    $(TEST_SPEC_SRCS)

# All source files
ALL_SRCS =                  \
    $(BASE_SRCS)            \
    $(MAIN_SPEC_SRCS)       \
    $(TEST_SPEC_SRCS)

all: run

run: 
	$(JSVM) $(MAIN_SRCS)

test: 
	$(JSVM) $(TEST_SRCS)

doc: $(SRCS)
	jsdoc -d=../doc/source $(MAIN_SRCS)

